---
title: "[java] ì£¼ì‚¬ìœ„ ê²Œì„ ê°ì²´ì§€í–¥ìœ¼ë¡œ ê°œë°œ"
excerpt: "ì£¼ì‚¬ìœ„ ê²Œì„ ê°ì²´ì§€í–¥ìœ¼ë¡œ ê°œë°œ"

categories:
  - service-develop
tags:
  - [java]

permalink: /service-develop/dice_game/

toc: true
toc_sticky: true

date: 2022-04-03
last_modified_at: 2022-04-03
---


## ğŸ¦¥ ìš”ê±´ ì •ì˜

 - 2ì¸ ì´ìƒì— ê²Œì„ì„ í•œë‹¤. 
 - ê²Œì´ë¨¸ê°€ ì£¼ì‚¬ìœ„ë¥¼ 3ë²ˆ ë˜ì ¸ ë‚˜ì˜¨ ìˆ˜ë¥¼ í•©í•œë‹¤. 
 - 10ì´í•˜ì´ë©´, 1ë²ˆ ë” ë˜ì ¸ ë‚˜ì˜¨ ìˆ˜ë¥¼ í•©í•´ì¤€ë‹¤.
 - ì´ë²ˆì—” ìƒëŒ€ë°©ì´ ì£¼ì‚¬ìœ„ë¥¼ 3ë²ˆ ë˜ì ¸ ë‚˜ì˜¨ ìˆ˜ë¥¼ í•©í•œë‹¤.  
 - ë™ì¼í•˜ê²Œ 10ì´í•˜ì´ë©´ 1ë²ˆ ë” ë˜ì ¸ ë‚˜ì˜¨ ìˆ˜ë¥¼ í•©í•œë‹¤. 
 - 15ì— ê°€ì¥ ê°€ê¹Œìš´ ì‚¬ëŒì´ ìŠ¹ë¦¬í•œë‹¤. 
 - ë™ì ì´ ë‚˜ì˜¨ ê²½ìš°, 1ë“±ì´ ë‚˜ì˜¬ë•Œê¹Œì§€ ë‹¤ì‹œ ë˜ì§„ë‹¤. 
 - console ë¡œ ê²°ê³¼ë¥¼ ì¶œë ¥í•œë‹¤. 

 - ë¨¼ì € ì£¼ì‚¬ìœ„ ê°ì²´ë¥¼ ì •ì˜í•œë‹¤. 
 - enum ì„ í†µí•´ ì‹±ê¸€í†¤ ê°ì²´ë¡œ ë§Œë“¤ì—ˆë‹¤. 
 - ëœë¤ìˆ˜ ìƒì„±ì‹œ, jdk7 ë¶€í„°ëŠ” ThreadLocalRandom ì„ ì‚¬ìš©í•˜ëŠ”ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. 

```java
/**
 * ì£¼ì‚¬ìœ„ ê°ì²´
 *
 */
public enum Dice {
	
	INSTANCE;
	
	private static int MAX_NUM = 6;
	private static int MIN_NUM = 1;
	
	public int drawOneDiceNumber() {
		return ThreadLocalRandom.current().nextInt(MIN_NUM, MAX_NUM+1);
	}
}
```

 - ìœ ì € ê°ì²´ë¥¼ ì •ì˜í•œë‹¤. 

```java

public class User {
	
	private String id;
	private String name;
	private int score;
	
	List<Integer> scores = new ArrayList<>();
	
	public User(String id, String name) {
		this.id = id;
		this.name = name;
	}
	public String getId() {
		return id;
	}
	public String getName() {
		return name;
	}
	public int getScore() {
		return score;
	}
    //ì£¼ì‚¬ìœ„ë¥¼ ë˜ì§ˆë•Œë§ˆë‹¤ ì ìˆ˜ë¥¼ ë”í•œë‹¤.
	public void addScore(int score) {
		scores.add(score);
		this.score += score;
	}
    //ëª©í‘œ ì ìˆ˜ë¥¼ ê³„ì‚°í•œë‹¤.
	public int diffScore(int number) {
		return Math.abs(this.score - number);
	}
    //ìŒ“ì¸ ì ìˆ˜ ì´ë ¥ì„ ì €ì¥
	public List<Integer> getScores(){
		return this.scores;
	}
	@Override
	public String toString() {
		return "User [id=" + id + ", name=" + name + ", score=" + score + "]";
	}
}
```

 - ì£¼ì‚¬ìœ„ê²Œì„ ê°ì²´ë¥¼ ì •ì˜í•œë‹¤. 
 - ìœ ì €ê·¸ë£¹ê³¼ ê²Œì„ë£°ì„ ë³€ìˆ˜ë¡œ ê°–ëŠ”ë‹¤. 

```java
public class DiceGame implements Game<User>{
	
	private final DiceRule rule;
	private final List<User> users;
	
	public DiceGame(DiceRule rule, List<User> users) {
		this.rule = rule;
		this.users = users;
	}

	@Override
	public void play() {
		this.rule.process(users);
	}
}

// ê²Œì„ ì¸í„°í˜ì´ìŠ¤
public interface Game<T> {
	void play();
}
``` 

 - ë‹¤ìŒì€ ê²Œì„ ë£°ì„ ì •ì˜í•œë‹¤. 
 - í…œí”Œë¦¿ë©”ì†Œë“œ íŒ¨í„´ì„ ì´ìš©í•˜ì—¬, ìì‹í´ë˜ìŠ¤ì—ì„œ ì¶”ê°€ ë˜ëŠ” ë£°ì„ ì •ì˜í•œë‹¤. 

```java
public abstract class DiceRule{
	
	protected static int MIN_SCORE = 10; //ìµœì € ì ìˆ˜
	protected static int BOUNCE_SCORE = 15; //ëª©í‘œ ì ìˆ˜
	protected static int DEFAULT_COUNT = 3; //ê¸°ë³¸ íšŸìˆ˜
	
	Dice dice = Dice.INSTANCE; //ì£¼ì‚¬ìœ„
	
	//ì‚¬ìš©ìê°€ ì£¼ì‚¬ìœ„ë¥¼ 1ë²ˆ ë˜ì§„ë‹¤. 
	protected User draw(User user) {
		user.addScore(dice.drawOneDiceNumber());
		return user;
	}
	
	//ì‚¬ìš©ì ê·¸ë£¹ì´ ì£¼ì‚¬ìœ„ë¥¼ 1ë²ˆì”© ë˜ì§„ë‹¤. 
	protected void draw(List<User> users) {
		users.stream().forEach((u) ->{
			draw(u);
		});
	}
	
	//ì‚¬ìš©ì ê·¸ë£¹ì„ ì¡°íšŒí•˜ì—¬, 10ì´í•˜ì¸ ê²½ìš°, 1ë²ˆì”© ë” ë˜ì§„ë‹¤.
	protected void oneMore(List<User> users) {
		while(true) {
			if(users.stream().filter(u -> u.getScore() <= MIN_SCORE).map(u->draw(u)).count()==0) break;
		}
	}
	
	//ë™ì ì ì¡´ì¬ ìœ ë¬´ë¥¼ ë¦¬í„´í•œë‹¤.
	protected boolean retry(List<User> users){
		
		int min = Integer.MAX_VALUE;
		for(User user: users) {
			int result = user.diffScore(BOUNCE_SCORE);
			if(min == result) return true;
			if(min > result) min = result;
			
		}
		return false;
	}

	//ìš°ìŠ¹ìë¥¼ ì°¾ëŠ”ë‹¤. 
	protected User decideWinner(List<User> users) {
		
		int min = Integer.MAX_VALUE;
		
		User winnerUser = null;
		
		for(User user: users) {
			int result = user.diffScore(BOUNCE_SCORE);
			if(min > result) {
				min = result;
				winnerUser = user;
			}else if(min == result) {
				throw new IllegalStateException("ë™ì¼í•œ ì ìˆ˜ì…ë‹ˆë‹¤.");
			}
		}
		return winnerUser;
	}
	
	/**
	 * ê²Œì„ì„ ì§„í–‰í•œë‹¤. 
	 * @param users
	 */
	public void process(List<User> users) {

		List<User> result = new ArrayList<>(users);
		for (int i = 0; i < DEFAULT_COUNT; i++) {
			draw(result);
		}
		oneMore(result);
		addProcess(result); // ì¶”ê°€ ë£° êµ¬í˜„
		printResult(result);
	}
	
	private void printResult(List<User> result) {
		for(User user : result) {
			System.out.println(user.getId() + " - "+ user.getScores());
		}
		System.out.println(result);
		System.out.println(decideWinner(result));
	}

	//ì¶”ê°€ì ì¸ ë£°ì€ ì•„ë˜ ë©”ì„œë“œë¥¼ êµ¬í˜„í•œë‹¤. (í…œí”Œë¦¿ íŒ¨í„´)
	public abstract void addProcess(List<User> users);
	
}
```

- DiceRuleVer2ë¥¼ í†µí•´ ë™ì ìê°€ ìˆëŠ” ê²½ìš°, ì£¼ì‚¬ìœ„ë¥¼ í•œë²ˆì”© ë” ë˜ì§€ëŠ” ë£°ì„ ì¶”ê°€

```java
public class DiceRuleVer2 extends DiceRule {

	@Override
	public void addProcess(List<User> users) {
		while(true) { if(!retry(users)) break; draw(users); }
	}
}
```

 - ê²Œì„ ì‹¤í–‰

```java
 public class App {
	
	public static void main(String[] args) {
		
		List<User> users = Arrays.asList(new User("11","sk"),new User("12","uo"), new User("13","kk") );
		DiceGame game = new DiceGame(new DiceRuleVer2() , users);
		
		try {
			game.play();
		}catch(IllegalStateException e) {
			System.out.println("ë¬´ìŠ¹ë¶€");
		}
	}
}
```

# Reference
